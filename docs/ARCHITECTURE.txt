┌─────────────────────────────────────────────────────────────┐
│                    ABSTRACT BASE LAYER                       │
│                (Defines Interface Contracts)                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────┐   ┌─────────────────────┐ │
│  │ AbstractTransaction         │   │ AbstractSource       │ │
│  ├─────────────────────────────┤   ├─────────────────────┤ │
│  │ + amount                    │   │ + source_name       │ │
│  │ + date                      │   │                     │ │
│  │ + description               │   │ @abstractmethod     │ │
│  │                             │   │ + fetch_data()      │ │
│  │ @abstractmethod             │   │ + process_data()    │ │
│  │ + impact_on_balance()       │   └─────────────────────┘ │
│  │ + ttype                     │                            │
│  └─────────────────────────────┘                            │
│           ▲ inherits                                         │
│           │                                                 │
└───────────┼─────────────────────────────────────────────────┘
│
┌───────────┴─────────────────────────────────────────────────┐
│            CONCRETE IMPLEMENTATION LAYER                     │
│            (Inheritance & Polymorphism)                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────┐  ┌──────────────────┐  ┌────────────┐│
│  │ ExpenseTransaction│  │ IncomeTransaction│  │ WebSource ││
│  ├──────────────────┤  ├──────────────────┤  ├────────────┤│
│  │ impact_on_balance│  │ impact_on_balance│  │ fetch_data()││
│  │   → -amount      │  │   → +amount      │  │ process_data││
│  │ ttype = 'expense'│  │ ttype = 'income' │  │            ││
│  └──────────────────┘  └──────────────────┘  └────────────┘│
│                                                             │
│  ┌──────────────┐   ┌───────────────┐   ┌───────────────┐ │
│  │ DatabaseSource│   │ FileSource    │   │ OtherSources  │ │
│  ├──────────────┤   ├───────────────┤   ├───────────────┤ │
│  │ fetch_data() │   │ fetch_data()  │   │ fetch_data()  │ │
│  │ process_data │   │ process_data  │   │ process_data  │ │
│  └──────────────┘   └───────────────┘   └───────────────┘ │
└─────────────────────────────────────────────────────────────┘
│
│ used by
▼
┌─────────────────────────────────────────────────────────────┐
│                  COMPOSITION LAYER                          │
│                (System Coordination)                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────┐           │
│  │ FinanceLedger                                │           │
│  ├─────────────────────────────────────────────┤           │
│  │ + owner                                     │           │
│  │ + _transactions[]                           │           │
│  │ + _category_budgets                         │           │
│  │                                             │           │
│  │ + add_transaction()                          │           │
│  │ + total_spent(start, end)                    │           │
│  │ + month_summary(year, month)                 │           │
│  │ + search(query)                              │           │
│  │ + top_categories(n)                          │           │
│  │ + detect_recurring(min_occurrences)          │           │
│  │ + trend()                                    │           │
│  │                                             │           │
│  │ Contains many Transaction objects            │           │
│  │ Uses multiple Source objects                 │           │
│  └─────────────────────────────────────────────┘           │
└─────────────────────────────────────────────────────────────┘

# Key Relationships

## INHERITANCE (is-a)

* ExpenseTransaction IS-A AbstractTransaction
* IncomeTransaction IS-A AbstractTransaction
* WebSource, DatabaseSource, FileSource IS-A AbstractSource

## COMPOSITION (has-a / has-many)

* FinanceLedger HAS-MANY Transaction objects
* FinanceLedger HAS-MANY Source objects (for data ingestion)

## POLYMORPHISM (same method, different behavior)

* impact_on_balance() behaves differently for income vs. expense
* ttype returns different labels ('income' or 'expense')
* fetch_data() and process_data() behave differently depending on source type

---

## System Flow Example

1. User creates FinanceLedger
   └─→ Ledger initializes empty _transactions[] and optional category budgets

2. User adds transactions
   └─→ ledger.add_transaction('expense', 'Coffee', 4.75, '2025-11-23')
   └─→ Factory creates ExpenseTransaction
   └─→ Transaction validated and stored in ledger

3. User fetches data from sources
   └─→ Ledger uses WebSource / DatabaseSource / FileSource
   └─→ Each fetch_data() and process_data() differently
   └─→ Normalized transactions added to ledger

4. User queries transactions
   └─→ ledger.search('coffee')
   └─→ Returns matching transactions

5. User generates reports
   └─→ ledger.month_summary(2025, 11)
   └─→ Aggregates totals, categories, and trends

---

## Why This Architecture Works

### Abstract Layer Benefits

* Enforces consistent interfaces
* Prevents incomplete implementations
* Improves correctness and reliability

### Concrete Layer Benefits

* Enables specialized behavior per transaction and source
* Demonstrates polymorphism in practice
* Simplifies future extensions

### Composition Layer Benefits

* Centralized coordination without tight coupling
* Clear responsibility boundaries
* Strong maintainability and testability


